<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интернет-магазин | Авторизация </title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
</head>

<body>
    <main class="container">
        <form id="auth">
            <!-- Email input -->
            <div data-mdb-input-init class="form-outline mb-4">
                <input type="email" id="form2Example1" class="form-control" name="authEmail"/>
                <label class="form-label" for="form2Example1">Email address</label>
            </div>

            <!-- Password input -->
            <div data-mdb-input-init class="form-outline mb-4">
                <input type="password" id="form2Example2" class="form-control" name="authPassword"/>
                <label class="form-label" for="form2Example2">Password</label>
            </div>


            <!-- Submit button -->
            <button type="submit" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary btn-block mb-4">Sign
                in</button>

        </form>
        <script>
            const $form = document.querySelector('#auth')
            $form.addEventListener('submit', (e)=> {
                e.preventDefault()

                let objData = {
                    email: $form.querySelector('[name="authEmail"]').value,
                    password: $form.querySelector('[name="authPassword"]').value
                }

                fetch('/api/validateUserData', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(objData)
                })
                // .then((res)=> {
                //     if(res.ok) {
                //         console.log(res)
                //         console.log('Пользователь найден')
                //     } else {
                //         console.log('ошибка авторизации')
                //     }
                // })
                .then(res => res.json())
                .then((data)=> {
                    console.log(data)

                    if (data.auth) {
                        //покажем витрину
                        fetch('/?logged=1').then()
                    }
                    else {
                        let htmlNode = document.createElement('div')
                        htmlNode.innerHTML = `
                            <div class="alert alert-danger" role="alert">
                            ${data.message}
                            </div>
                        `

                        $form.appendChild(htmlNode)
                    }

                })
            })
        </script>
    </main>
    

    <!-- <form method="POST" action="/auth" name="auth" id="formAuth" enctype="text/plain">
        <input type="text" placeholder="Введите логин" name="login">
        <input type="text" placeholder="Введите пароль" name="password">
        <input type="submit">
    </form> -->
</body>

</html>